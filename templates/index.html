<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPT Maker</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f4f7f6; color: #333; line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 40px auto; padding: 30px; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; }
        form { display: flex; flex-direction: column; gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 8px; color: #34495e; }
        input[type="file"] { border: 1px solid #ccc; padding: 10px; border-radius: 4px; background-color: #ecf0f1; }
        input[type="submit"] { background-color: #3498db; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        input[type="submit"]:hover { background-color: #2980b9; }
        input[type="submit"]:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        
        /* New styles for the progress bar */
        #progress-wrapper { display: none; text-align: center; }
        #progressBar { width: 100%; height: 25px; margin-top: 10px; }
        #status { color: #2c3e50; }
        #loaded_n_total { color: #7f8c8d; }

    </style>
</head>
<body>
    <div class="container">
        <h1>PPT Presentation Generator</h1>
        
        <!-- The form now has an ID so we can select it with JavaScript -->
        <form id="upload-form" action="/create" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="questions">1. Upload Question Images (PNG, JPG):</label>
                <input type="file" id="questions" name="questions" accept="image/png, image/jpeg" multiple required>
            </div>
            <div class="form-group">
                <label for="background">2. Upload Background Image (PNG, JPG):</label>
                <input type="file" id="background" name="background" accept="image/png, image/jpeg" required>
            </div>
            <input type="submit" value="Create Presentation">
        </form>

        <!-- New section for displaying upload progress. It's hidden by default. -->
        <div id="progress-wrapper">
            <h3 id="status">Uploading...</h3>
            <progress id="progressBar" value="0" max="100"></progress>
            <p id="loaded_n_total"></p>
        </div>
    </div>

    <script>
        const form = document.getElementById('upload-form');
        const progressBar = document.getElementById('progressBar');
        const progressWrapper = document.getElementById('progress-wrapper');
        const statusText = document.getElementById('status');
        const loadedText = document.getElementById('loaded_n_total');

        form.addEventListener('submit', function(e) {
            // Stop the form from submitting the traditional way
            e.preventDefault();

            // Hide the form and show the progress bar
            form.style.display = 'none';
            progressWrapper.style.display = 'block';

            // Create a FormData object from the form
            const formData = new FormData(form);

            // Create a new AJAX request
            const xhr = new XMLHttpRequest();
            
            // Listen for upload progress events
            xhr.upload.addEventListener('progress', function(e) {
                if (e.lengthComputable) {
                    const percentComplete = (e.loaded / e.total) * 100;
                    progressBar.value = percentComplete;
                    loadedText.textContent = `Uploaded ${Math.round(e.loaded / 1024 / 1024)} MB of ${Math.round(e.total / 1024 / 1024)} MB`;
                }
            });

            // Listen for when the request is complete
            xhr.addEventListener('load', function() {
                // When upload finishes, update status
                statusText.textContent = 'Processing... Please wait.';
                // The server will respond with the HTML of the result page.
                // We replace the entire current page's content with the response.
                if (xhr.status === 200) {
                    document.open();
                    document.write(xhr.responseText);
                    document.close();
                } else {
                    statusText.textContent = 'An error occurred during upload.';
                    // Optionally show the form again
                    form.style.display = 'block';
                    progressWrapper.style.display = 'none';
                }
            });

            // Open the request and send the form data
            xhr.open('POST', '/create');
            xhr.send(formData);
        });
    </script>
</body>
</html>
